<%- @add_to_html_head = capture do -%>
  <%= javascript_include_tag 'jquery.dataTables.min.js', 'account-listing.js' %>
<%- end -%>
<div id="list_heading"><h1>My Account</h1></div>
<div class="account_container">
  <h2>Notices: <span class="account-total"><%= @user_checkouts.overdue_count + @user_checkouts.recalled_count %></span><%= "&nbsp;&nbsp;&middot;&nbsp;&nbsp;" + link_to( "Renew All Items", renew_all_path, :class => "renew-all-link" ) if @user_checkouts.checkouts.count > 0 %></h2>

  <% if @user_checkouts.checkouts.count > 0 %>
    <% notice_count = 1 %>
    <% notices = @user_checkouts.sorted_checkouts.find_all { |checkout| checkout.overdue? or checkout.recalled? }%>
    <% if notices.count > 0 %>
      <table id="notices_listing" class="account-listing">
        <thead>
        <tr>
          <th class="account-number-heading hidden-heading"> <!-- Number --> </th>
          <th class="account-title-heading">Title</th>
          <th class="account-author-heading">Creator</th>
          <th class="account-due-heading">Due Date</th>
          <th class="account-library-heading">Library</th>
          <th class="account-call-heading">Call #</th>
        </tr>
        </thead>
        <tbody>
      <% notices.each do |notice| %>
        <% notice.catalog_item.holdings.each do |holding| %>
          <% holding.copies.each do |copy| %>
            <tr class="item <%= cycle("even", "odd") %>">
              <% title = notice.catalog_item.title %>
              <% title += " : #{notice.catalog_item.subtitle}" unless notice.catalog_item.subtitle.blank? %>
              <td class="item-number"><%= notice_count.to_s + "." %></td>
              <td class="title"><%= link_to(title, catalog_path("u#{notice.catalog_item.key}")) %></td>
              <td class="author"><%= notice.catalog_item.authors %></td>
              <td class="date account-notice-container"><%= notice.date_due_f %><%= "<span class='account-notice overdue'>overdue</span>" if notice.overdue? %><%= "<span class='account-notice recalled'>recalled</span>" if notice.recalled? %></td>
              <td class="location"><%= holding.library.name %></td>
              <td class="call-number"><%= holding.call_number %></td>
            </tr>
            <% notice_count += 1 %>
          <% end %>  
        <% end %>
      <% end %>
        </tbody>
      </table>
    <% else %>
      <h2 class="no-items">No Current Notices</h2>  
    <% end %>
  <%else %>
    <h2 class="no-items">No Current Notices</h2>
  <% end %>
</div>

<% sidebar_items << capture do %>
  <%= render :partial => 'sidebar', :locals => {:user => @user_checkouts} %>
<% end %>
